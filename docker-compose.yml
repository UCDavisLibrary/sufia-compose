version: '2'
services:
    web:
        build: .
        working_dir: /unison
        environment:
            - APP_HOME=/unison
            - BUNDLE_GEMFILE=/unison/Gemfile
        command: bin/rails server --port 3000 --binding 0.0.0.0
        ports:
            - "3000:3000"
        volumes:
            #- .:/usr/src/app
            - bundle:/bundle
        volumes_from:
            - unison
        depends_on:
            - redis
            - solr
            - fcrepo
            - mysql

    redis:
        image: redis:3
        ports:
          - "6379:6379"
    mysql:
        image: mysql:5.6
        environment:
          - MYSQL_ALLOW_EMPTY_PASSWORD=true
    solr:
        image: solr:5.5
        ports:
          - "8983:8983"
        volumes:
          - ./solr/config:/opt/config
    fcrepo:
        image: lyrasis/fcrepo:4.5.0
        volumes:
            - fcrepo_data:/opt/data
        ports:
          - "8984:8080"
    unison:
        # image: leighmcculloch/unison
        # image: ecc22beed337
        image: botimer/unison-fsmonitor
        environment:
            - UNISON_VERSION=2.48.3
        ports:
            - "5000:5000"

volumes:
    bundle:
        driver: local
    fcrepo_data:
        driver: local

